/*!build time : 2014-06-17 3:31:59 PM*/
KISSY.add("gallery/uri/1.0/index",["path"],function(a,b){function c(a){a._queryMap||(a._queryMap=i.unparam(a._query))}function d(a){this._query=a||""}function e(a){return 1===a.length?"0"+a:a}function f(a,b){return a.toLowerCase()===b.toLowerCase()}function g(a,b){return encodeURI(a).replace(b,function(a){return"%"+e(a.charCodeAt(0).toString(16))})}function h(b){if(b instanceof h)return b.clone();var c,e=this;return i.mix(e,{scheme:"",userInfo:"",hostname:"",port:"",path:"",query:"",fragment:""}),c=h.getComponents(b),i.each(c,function(b,c){if(b=b||"","query"===c)e.query=new d(b);else{try{b=i.urlDecode(b)}catch(f){a.error(f+"urlDecode error : "+b)}e[c]=b}}),e}var i=a,j=b("path"),k=/[#\/\?@]/g,l=/[#\?]/g,m=/[#@]/g,n=/#/g,o=new RegExp("^(?:([\\w\\d+.-]+):)?(?://(?:([^/?#@]*)@)?([\\w\\d\\-\\u0100-\\uffff.+%]*|\\[[^\\]]+\\])(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),p={scheme:1,userInfo:2,hostname:3,port:4,path:5,query:6,fragment:7};return d.prototype={constructor:d,clone:function(){return new d(this.toString())},reset:function(a){var b=this;return b._query=a||"",b._queryMap=null,b},count:function(){var a,b,d=this,e=0;c(d),a=d._queryMap;for(b in a)i.isArray(a[b])?e+=a[b].length:e++;return e},has:function(a){var b,d=this;return c(d),b=d._queryMap,a?a in b:!i.isEmptyObject(b)},get:function(a){var b,d=this;return c(d),b=d._queryMap,a?b[a]:b},keys:function(){var a=this;return c(a),i.keys(a._queryMap)},set:function(a,b){var e,f=this;return c(f),e=f._queryMap,"string"==typeof a?f._queryMap[a]=b:(a instanceof d&&(a=a.get()),i.each(a,function(a,b){e[b]=a})),f},remove:function(a){var b=this;return c(b),a?delete b._queryMap[a]:b._queryMap={},b},add:function(a,b){var e,f,g=this;if("string"==typeof a)c(g),e=g._queryMap,f=e[a],f=void 0===f?b:[].concat(f).concat(b),e[a]=f;else{a instanceof d&&(a=a.get());for(var h in a)g.add(h,a[h])}return g},toString:function(a){var b=this;return c(b),i.param(b._queryMap,void 0,void 0,a)}},h.prototype={constructor:h,clone:function(){var a=new h,b=this;return i.each(p,function(c,d){a[d]=b[d]}),a.query=a.query.clone(),a},resolve:function(a){"string"==typeof a&&(a=new h(a));var b,c=this,d=0,e=["scheme","userInfo","hostname","port","path","query","fragment"],f=c.clone();return i.each(e,function(c){if("path"===c)if(d)f[c]=a[c];else{var e=a.path;e&&(d=1,i.startsWith(e,"/")||(f.hostname&&!f.path?e="/"+e:f.path&&(b=f.path.lastIndexOf("/"),-1!==b&&(e=f.path.slice(0,b+1)+e))),f.path=j.normalize(e))}else"query"===c?(d||a.query.toString())&&(f.query=a.query.clone(),d=1):(d||a[c])&&(f[c]=a[c],d=1)}),f},getScheme:function(){return this.scheme},setScheme:function(a){return this.scheme=a,this},getHostname:function(){return this.hostname},setHostname:function(a){return this.hostname=a,this},setUserInfo:function(a){return this.userInfo=a,this},getUserInfo:function(){return this.userInfo},setPort:function(a){return this.port=a,this},getPort:function(){return this.port},setPath:function(a){return this.path=a,this},getPath:function(){return this.path},setQuery:function(a){return"string"==typeof a&&(i.startsWith(a,"?")&&(a=a.slice(1)),a=new d(g(a,m))),this.query=a,this},getQuery:function(){return this.query},getFragment:function(){return this.fragment},setFragment:function(a){var b=this;return i.startsWith(a,"#")&&(a=a.slice(1)),b.fragment=a,b},isSameOriginAs:function(a){var b=this;return f(b.hostname,a.hostname)&&f(b.scheme,a.scheme)&&f(b.port,a.port)},toString:function(a){var b,c,d,e,f,h,m,o=[],p=this;return(b=p.scheme)&&(o.push(g(b,k)),o.push(":")),(c=p.hostname)&&(o.push("//"),(m=p.userInfo)&&(o.push(g(m,k)),o.push("@")),o.push(encodeURIComponent(c)),(e=p.port)&&(o.push(":"),o.push(e))),(d=p.path)&&(c&&!i.startsWith(d,"/")&&(d="/"+d),d=j.normalize(d),o.push(g(d,l))),(h=p.query.toString(a))&&(o.push("?"),o.push(h)),(f=p.fragment)&&(o.push("#"),o.push(g(f,n))),o.join("")}},h.Query=d,h.getComponents=function(a){a=a||"";var b=a.match(o)||[],c={};return i.each(p,function(a,d){c[d]=b[a]}),c},h});